<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Splatoon3 Mini TPS</title>
<style>
body { margin:0; overflow:hidden; background:#111; color:#fff; font-family:sans-serif }
#ui { position:fixed; top:10px; left:10px; z-index:10 }
#center { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; font-size:48px }
canvas { display:block }
</style>
</head>
<body>

<div id="ui">
<div id="timer"></div>
<div id="hp"></div>
<div id="cool"></div>
</div>
<div id="center"></div>
<canvas id="c"></canvas>

<script>
const c = document.getElementById("c"), ctx = c.getContext("2d");
c.width = innerWidth; c.height = innerHeight;

let state="ready", cd=3, time=180;
const keys={};

const player={
 x:0,y:0, hp:100, speed:2.2, ink:0,
 squid:false, bombCD:0, sp:0
};

const enemy={
 x:300,y:200, hp:100, speed:1.9, bombCD:0
};

const bullets=[], bombs=[];

onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

function spawn(p){p.x=(Math.random()*600-300);p.y=(Math.random()*400-200);p.hp=100}

spawn(player); spawn(enemy);

setInterval(()=>{
 if(state==="ready"){
  document.getElementById("center").innerText = cd===3?"READY":cd;
  cd--; if(cd<0){state="game"; document.getElementById("center").innerText=""; }
 }
 else if(state==="game"){
  time--; if(time<=0) state="end";
 }
},1000);

function update(){
 if(state!=="game") return;

 // プレイヤー移動
 let dx=(keys.a?-1:0)+(keys.d?1:0);
 let dy=(keys.w?-1:0)+(keys.s?1:0);
 let sp = player.squid?3.5:player.speed;
 player.x+=dx*sp; player.y+=dy*sp;

 // イカ
 if(keys.Shift) player.squid=true; else player.squid=false;

 // 射撃
 if(keys[" "]){
  bullets.push({x:player.x,y:player.y,vx:Math.cos(0)*6,vy:Math.sin(0)*6,from:"p"});
 }

 // ボム
 if(keys.b && player.bombCD<=0){
  bombs.push({x:player.x,y:player.y,t:60,from:"p"});
  player.bombCD=300;
 }

 // スペシャル
 if(keys.e && player.sp>=100){
  bombs.push({x:player.x,y:player.y,t:20,from:"p",big:true});
  player.sp=0;
 }

 // 敵AI（近すぎない）
 if(dist(player,enemy)>120){
  let a=Math.atan2(player.y-enemy.y,player.x-enemy.x);
  enemy.x+=Math.cos(a)*enemy.speed;
  enemy.y+=Math.sin(a)*enemy.speed;
 }

 if(enemy.bombCD<=0){
  bombs.push({x:enemy.x,y:enemy.y,t:60,from:"e"});
  enemy.bombCD=360;
 }

 // クール
 player.bombCD--; enemy.bombCD--;
 player.sp+=0.1;

 // 当たり
 bullets.forEach((b,i)=>{
  if(b.from==="p" && dist(b,enemy)<20){ enemy.hp-=10; bullets.splice(i,1); }
  if(b.from==="e" && dist(b,player)<20){ player.hp-=10; bullets.splice(i,1); }
 });

 bombs.forEach((b,i)=>{
  b.t--;
  if(b.t<=0){
   if(b.from==="p" && dist(b,enemy)<60) enemy.hp-=40;
   if(b.from==="e" && dist(b,player)<60) player.hp-=40;
   bombs.splice(i,1);
  }
 });

 if(enemy.hp<=0) spawn(enemy);
 if(player.hp<=0) spawn(player);
}

function draw(){
 ctx.clearRect(0,0,c.width,c.height);

 // カメラ（TPS）
 ctx.save();
 ctx.translate(c.width/2-player.x,c.height/2-player.y);

 // プレイヤー
 ctx.fillStyle=player.squid?"purple":"lime";
 ctx.beginPath();ctx.arc(player.x,player.y,15,0,7);ctx.fill();

 // 敵
 ctx.fillStyle="red";
 ctx.beginPath();ctx.arc(enemy.x,enemy.y,15,0,7);ctx.fill();

 // 弾
 ctx.fillStyle="#fff";
 bullets.forEach(b=>{ctx.fillRect(b.x,b.y,4,4)});

 // ボム
 ctx.fillStyle="orange";
 bombs.forEach(b=>ctx.beginPath(),ctx.arc(b.x,b.y,b.big?40:20,0,7),ctx.fill());

 // 矢印
 let a=Math.atan2(enemy.y-player.y,enemy.x-player.x);
 ctx.strokeStyle="yellow";
 ctx.beginPath();
 ctx.moveTo(player.x,player.y);
 ctx.lineTo(player.x+Math.cos(a)*80,player.y+Math.sin(a)*80);
 ctx.stroke();

 ctx.restore();

 document.getElementById("timer").innerText=`TIME ${Math.floor(time/60)}:${time%60}`;
 document.getElementById("hp").innerText=`HP ${player.hp}`;
 document.getElementById("cool").innerText=`BOMB CD ${Math.max(0,player.bombCD)}`;
}

function loop(){
 update(); draw(); requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
